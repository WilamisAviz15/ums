worker_processes  1;  # Número de processos de trabalho do NGINX

events {
    worker_connections  1024;  # Máximo de conexões simultâneas
}

http {
    include       mime.types;  # Inclui os tipos MIME
    default_type  application/octet-stream;  # Tipo padrão para arquivos desconhecidos

    sendfile        on;  # Habilita envio eficiente de arquivos
    keepalive_timeout  65;  # Tempo de conexão keep-alive


    # Bloco do servidor principal
    server {
        listen 8000;  # Porta onde o NGINX escuta
        server_name localhost;  # Nome do servidor ou domínio


        # Configuração geral para /api/
        location /api/ {
            # Remove o prefixo '/api' da URL antes de passar para os microsserviços
            rewrite ^/api/(.*) /$1 break;
        }

        # Roteamento para os microsserviços
        location /api/auth/ {
            proxy_pass http://localhost:3006/auth/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/config/ {
            proxy_pass http://localhost:3333/api/config;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/meals/ {
            proxy_pass http://localhost:3007/meals/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/actions/ {
            proxy_pass http://localhost:3003/actions/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/meals-user-roles/ {
            proxy_pass http://localhost:3007/meals-user-roles/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/menus/ {
            proxy_pass http://localhost:3004/menus/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/menus-groups/ {
            proxy_pass http://localhost:3004/menus-groups/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/menu-meals/ {
            proxy_pass http://localhost:3007/menu-meals/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/metrics/ {
            proxy_pass http://localhost:3013/metrics/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;


        }

        location /api/payments/ {
            proxy_pass http://localhost:3011/payments/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/profile/ {
            proxy_pass http://localhost:3005/profile/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/ratings/ {
            proxy_pass http://localhost:3010/ratings/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/roles/ {
            proxy_pass http://localhost:3002/roles/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/schedules/ {
            proxy_pass http://localhost:3008/schedules/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/submeals/ {
            proxy_pass http://localhost:3007/submeals/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/users/ {
            proxy_pass http://localhost:3001/users/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/users-roles/ {
            proxy_pass http://localhost:3009/users-roles/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Adicionar cabeçalhos de segurança (opcional)
        add_header X-Frame-Options "SAMEORIGIN";
        add_header X-Content-Type-Options "nosniff";
        add_header X-XSS-Protection "1; mode=block";

        # Configurar erros
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;

        location = /50x.html {
            root html;  # Local onde os arquivos de erro estão armazenados
        }

        location = /404.html {
            root html;  # Local onde os arquivos de erro estão armazenados
        }
    }
}
